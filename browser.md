# 浏览器

## 从浏览器输入 URL 到页面展示过程发生了什么？

chrome多进程架构

* 浏览成进程：它负责用界面（地址栏，菜单等），子进程管理（例如进程通讯和数据传递 存储等）
* 渲染进程：它负责将接收到得`HTML`文档和`JavaScript`等转换为用户界面
* 网络进程：它负责网络资源的请求，例如http请求/websocket模块
* 图形处理进程：它负责对ui界面的展示
* 插件进程：它负责对插件的管理

过程详情

1. 解析输入

  发生这个过程的前提，用户在地址栏中输入了url，而地址拦会根据用户输入，做出如下判断

    输入的是非url结构的字符串，则会用浏览器默认的搜索引擎搜索该字符串
    
    茹茹的是url结构字符串，则会构建完整的url结构，浏览器进程会将完整的url通过进程间通讯，即`ipc`发送给网络进程

2. 请求过程

在网络进程接收到url后，并不是马上对指定url进行请求。首先，我们许可进行dns解析域名得到对应的ip然后通过`arp`解析ip得到对应的`mac`（Media Access Control Address）地址

* dns解析过程

  1. 查询浏览器dns缓存
  2. 询问本地操作系统dns缓存（即查找本地host文件）
  3. 询问`isp`（Internet Service Provider）互联网服务提供商（例如电信，移动）的dns服务器
  4. 询问根服务器，这个过程可以进行递归和迭代两种查找方式，两者都是先询问顶级域名服务器查找

* 通讯过程

  1. 首先建立tcp三次握手过程
  2. 然后利用tcp通道进行数据传输
  3. 最后断开tcp链接 即四次握手过程

3. 数据处理

当网络进程接收到响应报文的状态吗，进行相应的操作。例如`200 ok`时，会解析响应报文中的`Content-Type`首部字段。（这个过程`Content-Type`会出现 `application/javascript`, `text/css`, `text/html`, 即对应的 js文件/css文件/html文件）

4. 创建渲染进程

当前需要渲染html时，则需要创建渲染进程，用于后期渲染html。而对于渲染进程，如果时同一站点时可以共享一个渲染进程，例如a.abc.com和b.abc.com可以共享一个渲染进程。否则，需要重新创建渲染进程 （这里的同站指的是顶级域名和二级域名相同）

5. 渲染过程

这是最后一步 而页面渲染的过程可以分为如下九个步骤

* 解析html生成dom树
* 解析css生成cssom（css对象模型）
* 加载或执行js
* 生成渲染树（render tree）
* 布局
* 分层
* 生成绘制列表
* 光栅化
* 显示
